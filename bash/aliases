#!/usr/bin/env bash

# Easier navigation: .., ..., ...., ....., ~ and -
alias ..="cd .."
alias cd..="cd .."
alias ...="cd ../.."
alias ....="cd ../../.."
alias .....="cd ../../../.."
alias ~="cd ~" # `cd` is probably faster to type though
alias -- -="cd -"

# be nice
alias sudo='sudo ' # Enable aliases to be sudo’ed
alias please=sudo
alias hosts='sudo $EDITOR /etc/hosts'

# Shortcuts
alias d="cd ~/Documents/Dropbox"
alias p="cd ~/Projects"
alias g="git"
alias e="vim"
alias v="vim"
alias vim="vim -O"
alias s="subl ."
alias o="open"
alias oo="open ."
alias c='drawline'
alias reload='exec $SHELL -l'
alias rel='reload'

# History search
function h() {
    if [ -z "$1" ]
    then
        history | grep -v "  h" | sed 's/[ \t]*$//' | sort -k 2 -r | uniq -f 1 | sort -n
    else
        history | grep -v "  h" | grep $1 | sed 's/[ \t]*$//' | sort -k 2 -r | uniq -f 1 | sort -n
    fi
}

# GIT & SVN
alias gst='git st'
alias gs=gst

alias g1='git log -1'
#alias s1='svn log -l1'

# цветной diff git
gd()
{
    git diff "${@}" | colordiff
}
gds()
{
    git diff --staged "${@}" | colordiff
}
alias gdc=gds
alias sd='svn diff | colordiff'

# replace git read-only protocol to pushable ssh in current git repo
alias gitssh='sed -ie "s/git:\/\/\([^\/]*\)\/\(.*\)/git@\1:\2/g" .git/config'

# Detect which `ls` flavor is in use
if ls --color > /dev/null 2>&1; then # GNU `ls`
    colorflag="--color"
else # OS X `ls`
    colorflag="-G"
fi

# Listing
alias ls="command ls ${colorflag}" # Always use color output for `ls`
alias l="ls -l ${colorflag}"
alias ll="ls -laFo"
alias la="ls -la ${colorflag}"
alias lsd='ls -l ${colorflag} | grep "^d"' # List only directories
alias ltr='ls -ltr'

# `cat` with beautiful colors.
# Requires Pygments installed: sudo easy_install Pygments
alias cc='pygmentize -O style=monokai -f console256 -g'

# Create a new directory and enter it
function md() { mkdir -p "$@" && cd "$@"; }

# find shorthand
function f() { find . -name "$1"; }

export LS_COLORS='di=34:ln=35:ex=1;32:*.js=33:*.css=33:*.gz=31:*.tar=31:*.tgz=31:*.zip=31:*.bz2=31:*.deb=31:*.rpm=31:*.jar=31:*.png=32:*.jpg=32:*.jpeg=32:*.svg=32'

_expand()
{
    return 0;
}

# Misc
alias mine='sudo chown -R $USER:www .'

# Draws horizontal line and clears sreen
drawline()
{
    SEPARATOR="-"
    WIDTH=$(tput cols);
    echo -e "\033[$(($RANDOM % 7 + 31))m"
    ST=""
    for ((i=0; i<$WIDTH; i++)); do ST+=$SEPARATOR ; done
    echo $ST
    echo -e $RESET
    clear
}

# Universal make
if [[ `which gmake` != '' ]]; then
    alias make='gmake'
else
    alias gmake='make'
fi

# Universal ack
if [[ `which 'ack-grep'` != '' ]]; then
    alias ack='ack-grep'
fi

# OS X has no `md5sum`, so use `md5` as a fallback
type -t md5sum > /dev/null || alias md5sum="md5"

# Extracts archived files / mounts disk images
# credit: http://nparikh.org/notes/zshrc.txt
# Usage: extract <file>
# Note: .dmg/hdiutil is Mac OS X-specific.
extract () {
    if [ -f $1 ]; then
        case $1 in
            *.tar.bz2)  tar -jxvf $1                        ;;
            *.tar.gz)   tar -zxvf $1                        ;;
            *.bz2)      bunzip2 $1                          ;;
            *.dmg)      hdiutil mount $1                    ;;
            *.gz)       gunzip $1                           ;;
            *.tar)      tar -xvf $1                         ;;
            *.tbz2)     tar -jxvf $1                        ;;
            *.tgz)      tar -zxvf $1                        ;;
            *.zip)      unzip $1                            ;;
            *.ZIP)      unzip $1                            ;;
            *.pax)      cat $1 | pax -r                     ;;
            *.pax.Z)    uncompress $1 --stdout | pax -r     ;;
            *.Z)        uncompress $1                       ;;
            *)          echo "'$1' cannot be extracted/mounted via extract()" ;;
        esac
    else
        echo "'$1' is not a valid file"
    fi
}

# Intuitive map function
# For example, to list all directories that contain a certain file:
# find . -name .gitattributes | map dirname
alias map="xargs -n1"
